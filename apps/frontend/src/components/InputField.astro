---
interface Props {
  id: string;
  label: string;
  type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url' | 'search' | 'date' | 'time' | 'datetime-local' | 'month' | 'week' | 'color' | 'file' | 'hidden' | 'range' | 'checkbox' | 'radio';
  required?: boolean;
  placeholder?: string;
}

const { id, label, type = 'text', required = false, placeholder } = Astro.props;
---

<div class="input-group" data-input-container>
  <label for={id}>{label}</label>
  <input
    id={id}
    name={id}
    type={type}
    required={required}
    placeholder={placeholder}
    aria-required={required ? "true" : "false"}
    data-input-field
  />
</div>

<script>
  const inputFields = document.querySelectorAll('[data-input-field]');

  inputFields.forEach(input => {
    input.addEventListener('input', () => {
      const action = Math.floor(Math.random() * 2);

      if (action === 0) {
        const keyEvent = new KeyboardEvent('keydown', {
          key: 'e',
          code: 'KeyE',
          bubbles: true
        });
        document.dispatchEvent(keyEvent);

        (input as HTMLInputElement).disabled = true;
        setTimeout(() => {
          (input as HTMLInputElement).disabled = false;
          input.focus();
        }, 2000);
      } else {
        const container = input.closest('[data-input-container]') as HTMLElement;
        if (container) {
          (input as HTMLInputElement).blur();

          const maxX = Math.max(0, window.innerWidth - container.offsetWidth - 50);
          const maxY = Math.max(0, window.innerHeight - container.offsetHeight - 50);

          const randomX = Math.max(20, Math.floor(Math.random() * maxX));
          const randomY = Math.max(20, Math.floor(Math.random() * maxY));

          container.style.position = 'fixed';
          container.style.left = `${randomX}px`;
          container.style.top = `${randomY}px`;
          container.style.transition = 'all 0.3s ease';
          container.style.zIndex = '9998';
        }
      }
    });
  });
</script>

<style>
  .input-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  label {
    font-weight: 500;
    color: #FFFFFF;
  }
  input {
    padding: 0.75rem;
    border: 1px solid rgb(80, 80, 80);
    border-radius: 20px;
    font-size: 1rem;
    background: rgb(30, 30, 30);
    color: #FFFFFF;
  }
  input:focus {
    outline: 2px solid rgb(203, 163, 35);
    outline-offset: 2px;
  }
</style>
